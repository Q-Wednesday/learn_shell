# 编写第一个shell脚本
## shell脚本是啥
简单的解释就是包含一系列命令的文件，shell读取这个文件并执行这些命令。shell很独特，既是强大的命令行接口也是脚本解释器。

## 如何写
1. 编写脚本。需要一个文本编辑器，最好可以高亮。
2. 使脚本可以执行。系统不会把任何老式文本文件当作程序，需要给脚本设置权限为允许执行。
3. 把脚本放在shell可以发现的位置。

### 脚本的格式
创建hello world
```
#!bin/bash
# This is our first script

echo 'Hello World!'
```

### 可执行权限
需要修改权限，因为默认没有

### 脚本位置
执行 ./hello_world<br>
注意不能执行hello_world,必须要显示告知脚本位置。不加位置的话会在PATH里搜寻，通过echo $PATH就可以看到。把当前文件移动到PATH种或者把目录设置为PATH也可以不加./运行。在Ubuntu中，如果有~/bin,则当前用户会自动把~/bin添加到PATH中

### 脚本的理想位置
~/bin是存放个人脚本的理想位置。

## 更多的格式诀窍
认真编写脚本是给维护提供便利。

1. 长选命名<br>
很多命令有长选项，如ls -ad其实相当于 ls --all --directory<br>
在命令行敲的时候会选择短的，但是编写脚本可以选择长的。

2. 缩进和行连接<br>
把命令扩展为多行可以提高可读性，如
```
find playground \
    \( \
        -type f \
        -not -perm 0600 \
        -exec chmod 0600 '{}' ';' \

    \) \
    -or \
    \( \
        -type d \
        -not -perm 0700 \
        -exec chmod 0700 '{}' ';'
    \)
```
通过行连接符（反斜杠-回车符序列）和缩进可以清晰了解复杂命令的逻辑。其实在命令行里也能用，但是比较麻烦<br>

## 为了编写脚本配置vim
:syntax on可以打开语法高亮<br>
:set health 用来把搜索的结果高亮显示<br>
:set tabstop=4  设置tab的空格长度为4个<br>
:set autoindent 开启自动缩进<br>
把这些命令（不要前面的冒号）添加到-/.vimrc中，改变永久生效。


# 启动一个项目
编写一个报告生成器，显示系统的各种统计数据和状态并以HTML格式产生报告。这样就可以用Web浏览器查看。<br>
程序一般由一系列阶段组成，每一个阶段都会增加一些特性和功能，第一阶段就是创造不含任何系统信息的HTML页面

## 最小的文档
写一个脚本sys_info_page来输出一个foo.html。
由于我是在服务器上弄的，所以还会花一些时间用Nginx或Apache提供静态文件服务。

## 加入一点数据
## 变量和常量
使用变量替代常量更易于维护.
1. 创建变量和常量<br>
shell遇到一个变量后会自动创建变量而不需要声明。取得变量的值需要使用$。如果$一个不存在的变量，那么会被扩展为空，即`echo $foo`相当于`echo` 。

2. 变量和常量赋值<br>
shell不关心赋给变量的值的类型，它会把其都当作字符串。如`foo=z`,那么会把字符串"z"给foo。使用带-i选项的declare命令可以强制把变量转化为整数类型。但是，这如同把变量设置为只读一样，通常很少这样用。<br>
可以在一行给多个变量赋值，如
    ``` bash
    a=5 b="a string"
    ```
    在扩展期间可以用花括号括住扩展名称，如选择`${file}1`而不是`$file1`,如果我们只有file这个变量的话，可以得到$file+1这个值，这样很方便。

## here 文档
我们已经知道怎么用echo输出文本，此外还有成为hure文档或者here脚本的方法来输入文本。here文档是I/O重定向的另外一种形式，在脚本中嵌入正文文本，然后输入到一个命令的标准输入中，如
``` bash
command << token
text
token
```
token是用来指示结尾的字符串。比如
``` bash
cat << _EOF_
....
_EOF_
```
使用cat的here文档来替代echo。这会带来很多好处，比如""不再具有特殊意义，会被直接输出。而且使用<<- 可以忽略tab缩进，提供可读性

# 自顶向下设计
把大的任务拆分为小的任务。
## shell 函数
shell函数有两种语法形式
``` bash
function name{
    commands
    return
}
```
*name* 是函数名称，*commands* 是这个函数的一系列命令。第二种是
``` bash
name () {
    commands
    return
}
```
shell读取脚本的时候会跳过函数部分，当执行遇到调用函数的时候再跳到函数里去执行。shell函数的命名规则和变量相同。一个函数必须至少要包含一条命令。return命令（可选的）可以满足该要求

## 局部变量
在编写的脚本里，所有变量都是全局变量。在shell函数中经常要用到局部变量，仅在函数里有效。需要声明为
```
local foo
```

## 保持脚本的运行
进行改动后要对脚本进行测试。可以通过添加空函数(stub)来在早期验证程序流程（就是函数只输出信息不执行改动）<br>
df -h可以检查磁盘空间；du -sh是检查指定目录空间。

